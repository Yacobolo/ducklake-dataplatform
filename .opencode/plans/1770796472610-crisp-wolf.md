# Plan: Add Scalar API Reference Documentation (CDN)

## Summary
Serve interactive Scalar API docs at `/docs` and the raw OpenAPI spec at `/openapi.json`. Both endpoints are public (no auth). Uses the Scalar CDN — no Go library dependency needed.

## Changes

### 1. Modify `cmd/server/main.go`

**Move auth middleware** from global to the `/v1` group so `/docs` and `/openapi.json` are publicly accessible.

Current:
```go
r.Use(middleware.AuthMiddleware(jwtSecret, apiKeyRepo))  // global
r.Route("/v1", func(r chi.Router) {
    api.HandlerFromMux(strictHandler, r)
})
```

New:
```go
// Public endpoints (no auth)
r.Get("/openapi.json", serveOpenAPISpec)
r.Get("/docs", serveScalarDocs)

// Authenticated API routes
r.Route("/v1", func(r chi.Router) {
    r.Use(middleware.AuthMiddleware(jwtSecret, apiKeyRepo))
    api.HandlerFromMux(strictHandler, r)
})
```

**Add two handler functions** (inline or as closures in `main()`):

#### `/openapi.json` — serves the embedded OpenAPI spec as JSON
Uses the already-generated `api.GetSwagger()` function.

#### `/docs` — serves a minimal HTML page loading Scalar from CDN
```html
<!DOCTYPE html>
<html>
<head>
    <title>DuckDB Data Platform API</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@scalar/api-reference@1.44.16/dist/style.min.css" />
</head>
<body>
    <script id="api-reference" data-url="/openapi.json"></script>
    <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference@1.44.16/dist/browser/standalone.min.js"></script>
</body>
</html>
```

### 2. Add `encoding/json` import
Required for serializing the OpenAPI spec to JSON.

## Files Modified
- `cmd/server/main.go` — add `/docs` and `/openapi.json` routes, move auth middleware into `/v1` group

No new Go dependencies.

## Verification
1. `task build` — compiles
2. `task test` — existing tests pass
3. `go run ./cmd/server` → visit `http://localhost:8080/docs` — Scalar UI renders
4. `curl http://localhost:8080/openapi.json` — returns spec without auth
5. `curl http://localhost:8080/v1/principals` — still returns 401 (auth required)
