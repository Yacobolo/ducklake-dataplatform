paths:
  /catalog/schemas/{schemaName}/tables/{tableName}/ingestion/upload-url:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
      - name: tableName
        in: path
        required: true
        schema:
          type: string
    post:
      operationId: createUploadUrl
      summary: Get a presigned URL for uploading a Parquet file
      tags: [Ingestion]
      description: >
        Returns a presigned PUT URL that the client can use to upload a Parquet file
        directly to S3. The file can then be registered via the commit endpoint.
        Requires INSERT privilege on the target table.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/ingestion.yaml#/UploadUrlRequest'
      responses:
        '200':
          description: Presigned upload URL
          content:
            application/json:
              schema:
                $ref: '../schemas/ingestion.yaml#/UploadUrlResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '404':
          description: Table not found
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'

  /catalog/schemas/{schemaName}/tables/{tableName}/ingestion/commit:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
      - name: tableName
        in: path
        required: true
        schema:
          type: string
    post:
      operationId: commitTableIngestion
      summary: Register uploaded Parquet files in DuckLake
      tags: [Ingestion]
      description: >
        Registers previously uploaded files (from upload-url) in the DuckLake catalog.
        DuckLake validates schema compatibility, extracts column statistics, and
        registers files atomically. Requires INSERT privilege on the target table.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/ingestion.yaml#/CommitIngestionRequest'
      responses:
        '200':
          description: Ingestion result
          content:
            application/json:
              schema:
                $ref: '../schemas/ingestion.yaml#/IngestionResult'
        '400':
          description: Validation error (schema mismatch, missing files, etc.)
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '404':
          description: Table not found
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'

  /catalog/schemas/{schemaName}/tables/{tableName}/ingestion/load:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
      - name: tableName
        in: path
        required: true
        schema:
          type: string
    post:
      operationId: loadTableExternalFiles
      summary: Register existing S3 files in DuckLake
      tags: [Ingestion]
      description: >
        Registers existing S3 files or globs in the DuckLake catalog. Paths without
        an s3:// prefix are treated as relative to the lake data path. DuckLake validates
        schema compatibility, extracts column statistics, and registers files atomically.
        Requires INSERT privilege on the target table.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/ingestion.yaml#/LoadExternalRequest'
      responses:
        '200':
          description: Ingestion result
          content:
            application/json:
              schema:
                $ref: '../schemas/ingestion.yaml#/IngestionResult'
        '400':
          description: Validation error (schema mismatch, missing files, etc.)
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
        '404':
          description: Table not found
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'

        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
