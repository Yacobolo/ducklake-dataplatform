paths:
  /notebooks:
    get:
      operationId: listNotebooks
      summary: List notebooks
      tags: [Notebooks]
      description: Returns a paginated list of notebooks.
      parameters:
        - name: owner
          in: query
          description: Filter by owner principal name.
          schema:
            type: string
            maxLength: 255
            pattern: '^\S.*$'
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of notebooks
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/PaginatedNotebooks'
              example:
                data:
                - id: "550e8400-e29b-41d4-a716-446655440001"
                  name: Sales Analysis
                  description: Quarterly sales analysis notebook
                  owner: alice
                  created_at: '2025-01-15T09:30:00Z'
                  updated_at: '2025-01-20T14:00:00Z'
                next_page_token: eyJpZCI6MTB9
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    post:
      operationId: createNotebook
      summary: Create a notebook
      tags: [Notebooks]
      description: Creates a new SQL notebook.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/CreateNotebookRequest'
            example:
              name: Sales Analysis
              description: Quarterly sales analysis notebook
      responses:
        '201':
          description: Created notebook
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/Notebook'
              example:
                id: "550e8400-e29b-41d4-a716-446655440001"
                name: Sales Analysis
                description: Quarterly sales analysis notebook
                owner: alice
                created_at: '2025-01-15T09:30:00Z'
                updated_at: '2025-01-15T09:30:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '409':
          $ref: '../schemas/responses.yaml#/responses/Conflict'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    get:
      operationId: getNotebook
      summary: Get a notebook with cells
      tags: [Notebooks]
      description: Retrieves a notebook and its cells.
      responses:
        '200':
          description: Notebook with cells
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/NotebookDetail'
              example:
                notebook:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  name: Sales Analysis
                  description: Quarterly sales analysis notebook
                  owner: alice
                  created_at: '2025-01-15T09:30:00Z'
                  updated_at: '2025-01-20T14:00:00Z'
                cells:
                - id: "660e8400-e29b-41d4-a716-446655440010"
                  notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                  cell_type: sql
                  content: "SELECT region, SUM(amount) FROM sales GROUP BY region"
                  position: 0
                  created_at: '2025-01-15T09:31:00Z'
                  updated_at: '2025-01-15T09:31:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    patch:
      operationId: updateNotebook
      summary: Update notebook metadata
      tags: [Notebooks]
      description: Updates the name or description of a notebook.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/UpdateNotebookRequest'
            example:
              name: Updated Sales Analysis
              description: Updated quarterly sales analysis notebook
      responses:
        '200':
          description: Updated notebook
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/Notebook'
              example:
                id: "550e8400-e29b-41d4-a716-446655440001"
                name: Updated Sales Analysis
                description: Updated quarterly sales analysis notebook
                owner: alice
                created_at: '2025-01-15T09:30:00Z'
                updated_at: '2025-01-21T10:00:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    delete:
      operationId: deleteNotebook
      summary: Delete a notebook
      tags: [Notebooks]
      description: Deletes a notebook and all its cells.
      responses:
        '204':
          description: Notebook deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/cells:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: createCell
      summary: Add a cell to a notebook
      tags: [Notebooks]
      description: Creates a new cell in the specified notebook.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/CreateCellRequest'
            example:
              cell_type: sql
              content: "SELECT * FROM sales LIMIT 10"
              position: 0
      responses:
        '201':
          description: Created cell
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/Cell'
              example:
                id: "660e8400-e29b-41d4-a716-446655440010"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                cell_type: sql
                content: "SELECT * FROM sales LIMIT 10"
                position: 0
                created_at: '2025-01-15T09:31:00Z'
                updated_at: '2025-01-15T09:31:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/cells/reorder:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: reorderCells
      summary: Reorder cells in a notebook
      tags: [Notebooks]
      description: Reorders cells in the notebook according to the provided cell ID list.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/ReorderCellsRequest'
            example:
              cell_ids:
              - "660e8400-e29b-41d4-a716-446655440010"
              - "660e8400-e29b-41d4-a716-446655440011"
              - "660e8400-e29b-41d4-a716-446655440012"
      responses:
        '200':
          description: Reordered cells
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/CellList'
              example:
              - id: "660e8400-e29b-41d4-a716-446655440010"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                cell_type: sql
                content: "SELECT 1"
                position: 0
                created_at: '2025-01-15T09:31:00Z'
                updated_at: '2025-01-15T09:31:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/cells/{cellId}:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: cellId
        in: path
        required: true
        description: Unique identifier of the cell.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    patch:
      operationId: updateCell
      summary: Update a cell
      tags: [Notebooks]
      description: Updates the content or position of a cell.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/UpdateCellRequest'
            example:
              content: "SELECT region, SUM(amount) FROM sales GROUP BY region"
              position: 1
      responses:
        '200':
          description: Updated cell
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/Cell'
              example:
                id: "660e8400-e29b-41d4-a716-446655440010"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                cell_type: sql
                content: "SELECT region, SUM(amount) FROM sales GROUP BY region"
                position: 1
                created_at: '2025-01-15T09:31:00Z'
                updated_at: '2025-01-21T10:15:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    delete:
      operationId: deleteCell
      summary: Delete a cell
      tags: [Notebooks]
      description: Deletes a cell from the notebook.
      responses:
        '204':
          description: Cell deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  # === Session endpoints (Phase 2) ===
  /notebooks/{notebookId}/sessions:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: createNotebookSession
      summary: Start a notebook session
      tags: [Notebooks]
      description: Creates a new execution session with a pinned DuckDB connection.
      responses:
        '201':
          description: Created notebook session
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/NotebookSession'
              example:
                id: "770e8400-e29b-41d4-a716-446655440020"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                principal: alice
                state: active
                created_at: '2025-01-20T14:00:00Z'
                last_used_at: '2025-01-20T14:00:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/sessions/{sessionId}:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: sessionId
        in: path
        required: true
        description: Unique identifier of the session.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    delete:
      operationId: closeNotebookSession
      summary: Close a notebook session
      tags: [Notebooks]
      description: Closes the session and releases the DuckDB connection.
      responses:
        '204':
          description: Session closed
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/sessions/{sessionId}/execute/{cellId}:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: sessionId
        in: path
        required: true
        description: Unique identifier of the session.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: cellId
        in: path
        required: true
        description: Unique identifier of the cell.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: executeCell
      summary: Execute a single cell in a session
      tags: [Notebooks]
      description: Runs the cell's SQL through the RBAC/RLS pipeline on the pinned connection.
      responses:
        '200':
          description: Cell execution result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/CellExecutionResult'
              example:
                cell_id: "660e8400-e29b-41d4-a716-446655440010"
                columns: [region, total]
                rows:
                - [north, 15000]
                - [south, 22000]
                row_count: 2
                duration_ms: 45
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/sessions/{sessionId}/run-all:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: sessionId
        in: path
        required: true
        description: Unique identifier of the session.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: runAllCells
      summary: Execute all SQL cells in order (synchronous)
      tags: [Notebooks]
      description: Executes all SQL cells in the notebook sequentially on the pinned connection.
      responses:
        '200':
          description: Run-all result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/RunAllResult'
              example:
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                results:
                - cell_id: "660e8400-e29b-41d4-a716-446655440010"
                  columns: [region, total]
                  rows:
                  - [north, 15000]
                  row_count: 1
                  duration_ms: 30
                total_duration_ms: 120
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  # === Async job endpoints (Phase 3) ===
  /notebooks/{notebookId}/sessions/{sessionId}/run-all-async:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: sessionId
        in: path
        required: true
        description: Unique identifier of the session.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: runAllCellsAsync
      summary: Start async execution of all cells
      tags: [Notebooks]
      description: Starts asynchronous execution of all SQL cells in the notebook.
      responses:
        '202':
          description: Accepted notebook job
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/NotebookJob'
              example:
                id: "880e8400-e29b-41d4-a716-446655440030"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                session_id: "770e8400-e29b-41d4-a716-446655440020"
                state: pending
                created_at: '2025-01-20T14:05:00Z'
                updated_at: '2025-01-20T14:05:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/jobs:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    get:
      operationId: listNotebookJobs
      summary: List jobs for a notebook
      tags: [Notebooks]
      description: Returns a paginated list of jobs for the specified notebook.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of notebook jobs
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/PaginatedNotebookJobs'
              example:
                data:
                - id: "880e8400-e29b-41d4-a716-446655440030"
                  notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                  session_id: "770e8400-e29b-41d4-a716-446655440020"
                  state: complete
                  created_at: '2025-01-20T14:05:00Z'
                  updated_at: '2025-01-20T14:06:00Z'
                next_page_token: eyJpZCI6MTB9
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /notebooks/{notebookId}/jobs/{jobId}:
    parameters:
      - name: notebookId
        in: path
        required: true
        description: Unique identifier of the notebook.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
      - name: jobId
        in: path
        required: true
        description: Unique identifier of the job.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    get:
      operationId: getNotebookJob
      summary: Get job status
      tags: [Notebooks]
      description: Retrieves the status and result of a notebook job.
      responses:
        '200':
          description: Notebook job details
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/NotebookJob'
              example:
                id: "880e8400-e29b-41d4-a716-446655440030"
                notebook_id: "550e8400-e29b-41d4-a716-446655440001"
                session_id: "770e8400-e29b-41d4-a716-446655440020"
                state: complete
                created_at: '2025-01-20T14:05:00Z'
                updated_at: '2025-01-20T14:06:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  # === Git endpoints (Phase 4) ===
  /git-repos:
    get:
      operationId: listGitRepos
      summary: List registered Git repositories
      tags: [Notebooks]
      description: Returns a paginated list of registered Git repositories.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of Git repositories
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/PaginatedGitRepos'
              example:
                data:
                - id: "990e8400-e29b-41d4-a716-446655440040"
                  url: "https://github.com/example/notebooks.git"
                  branch: main
                  path: notebooks/
                  owner: alice
                  last_sync_at: '2025-01-20T12:00:00Z'
                  last_commit: a1b2c3d4e5f6
                  created_at: '2025-01-10T09:00:00Z'
                  updated_at: '2025-01-20T12:00:00Z'
                next_page_token: eyJpZCI6MTB9
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    post:
      operationId: createGitRepo
      summary: Register a Git repository
      tags: [Notebooks]
      description: Registers a new Git repository for notebook sync.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/notebooks.yaml#/CreateGitRepoRequest'
            example:
              url: "https://github.com/example/notebooks.git"
              branch: main
              path: notebooks/
              auth_token: ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      responses:
        '201':
          description: Created Git repository
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/GitRepo'
              example:
                id: "990e8400-e29b-41d4-a716-446655440040"
                url: "https://github.com/example/notebooks.git"
                branch: main
                path: notebooks/
                owner: alice
                created_at: '2025-01-10T09:00:00Z'
                updated_at: '2025-01-10T09:00:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '409':
          $ref: '../schemas/responses.yaml#/responses/Conflict'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /git-repos/{gitRepoId}:
    parameters:
      - name: gitRepoId
        in: path
        required: true
        description: Unique identifier of the Git repository.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    get:
      operationId: getGitRepo
      summary: Get a Git repository
      tags: [Notebooks]
      description: Retrieves the details of a registered Git repository.
      responses:
        '200':
          description: Git repository details
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/GitRepo'
              example:
                id: "990e8400-e29b-41d4-a716-446655440040"
                url: "https://github.com/example/notebooks.git"
                branch: main
                path: notebooks/
                owner: alice
                last_sync_at: '2025-01-20T12:00:00Z'
                last_commit: a1b2c3d4e5f6
                created_at: '2025-01-10T09:00:00Z'
                updated_at: '2025-01-20T12:00:00Z'
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    delete:
      operationId: deleteGitRepo
      summary: Delete a Git repository
      tags: [Notebooks]
      description: Deletes a registered Git repository.
      responses:
        '204':
          description: Git repository deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /git-repos/{gitRepoId}/sync:
    parameters:
      - name: gitRepoId
        in: path
        required: true
        description: Unique identifier of the Git repository.
        schema:
          type: string
          pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
          maxLength: 36
    post:
      operationId: syncGitRepo
      summary: Trigger Git sync
      tags: [Notebooks]
      description: Pulls latest changes from the Git repository and syncs notebooks.
      responses:
        '200':
          description: Git sync result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/notebooks.yaml#/GitSyncResult'
              example:
                notebooks_created: 3
                notebooks_updated: 1
                notebooks_deleted: 0
                commit_sha: a1b2c3d4e5f6
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
