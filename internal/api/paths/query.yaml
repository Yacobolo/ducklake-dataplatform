paths:
  /query:
    post:
      operationId: executeQuery
      summary: Execute SQL as authenticated principal
      description: Executes a SQL query against the DuckDB engine using the authenticated principal's permissions and security policies.
      tags: [Query]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/QueryRequest'
            example:
              sql: "SELECT id, name FROM main.users LIMIT 10"
      responses:
        '200':
          description: Query result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/QueryResult'
              example:
                columns:
                  - "id"
                  - "name"
                  - "email"
                rows:
                  - [1, "Alice Johnson", "alice@acme.com"]
                  - [2, "Bob Smith", "bob@acme.com"]
                row_count: 2
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
