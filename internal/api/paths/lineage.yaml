paths:
  /lineage/tables/{schemaName}/{tableName}:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/schemaName'
      - $ref: '../schemas/responses.yaml#/parameters/tableName'
    get: # apilint:ignore OAL025
      operationId: getTableLineage
      summary: Get full lineage for a table
      tags: [Lineage]
      description: Returns both upstream and downstream lineage edges for a table. Pagination params control edge depth, not list pagination.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Table lineage
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/LineageNode'
              example:
                table_name: "analytics.page_views"
                upstream:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                downstream:
                  - id: "550e8400-e29b-41d4-a716-446655440002"
                    source_table: "page_views"
                    target_table: "daily_metrics"
                    source_schema: "analytics"
                    target_schema: "reporting"
                    edge_type: READ
                    principal_name: "etl-service"
                     created_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /lineage/tables/{schemaName}/{tableName}/upstream:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/schemaName'
      - $ref: '../schemas/responses.yaml#/parameters/tableName'
    get:
      operationId: getUpstreamLineage
      summary: Get upstream lineage for a table
      description: Returns the upstream lineage edges representing data sources that feed into the specified table.
      tags: [Lineage]
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Upstream lineage edges
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PaginatedLineageEdges'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /lineage/tables/{schemaName}/{tableName}/downstream:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/schemaName'
      - $ref: '../schemas/responses.yaml#/parameters/tableName'
    get:
      operationId: getDownstreamLineage
      summary: Get downstream lineage for a table
      description: Returns the downstream lineage edges representing tables and views that depend on the specified table.
      tags: [Lineage]
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Downstream lineage edges
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PaginatedLineageEdges'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /lineage/edges/{edgeId}:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/edgeId'
    delete:
      operationId: deleteLineageEdge
      summary: Delete a lineage edge
      description: Permanently removes a lineage edge by its identifier.
      tags: [Lineage]
      responses:
        '204':
          description: Edge deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /lineage/purge:
    post:
      operationId: purgeLineage
      summary: Purge old lineage edges
      tags: [Lineage]
      description: Delete lineage edges older than the specified number of days.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/lineage.yaml#/PurgeLineageRequest'
            example:
              older_than_days: 90
      responses:
        '200':
          description: Purge result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PurgeLineageResponse'
              example:
                deleted_count: 42
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
