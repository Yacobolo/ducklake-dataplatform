paths:
  /lineage/tables/{schemaName}/{tableName}:
    parameters:
      - name: schemaName
        in: path
        required: true
        description: Name of the database schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
      - name: tableName
        in: path
        required: true
        description: Name of the table within the schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
    get: # apilint:ignore OAL025
      operationId: getTableLineage
      summary: Get full lineage for a table
      tags: [Lineage]
      description: Returns both upstream and downstream lineage edges for a table. Pagination params control edge depth, not list pagination.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Table lineage
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/LineageNode'
              example:
                table_name: "analytics.page_views"
                upstream:
                  - id: 1
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                downstream:
                  - id: 2
                    source_table: "page_views"
                    target_table: "daily_metrics"
                    source_schema: "analytics"
                    target_schema: "reporting"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
        '429':
          description: Rate limit exceeded. Retry after the indicated duration.
          headers:
            Retry-After:
              description: Seconds to wait before retrying the request.
              schema:
                type: integer
                minimum: 1
                maximum: 3600
                format: int32
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 429
                message: "Rate limit exceeded, retry after 30 seconds"
        '500':
          description: An unexpected internal server error occurred.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 500
                message: "An unexpected error occurred"
        '401':
          description: Unauthorized
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 401
                message: "Authentication required"
        '404':
          description: Not found
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 404
                message: "Resource not found"

  /lineage/tables/{schemaName}/{tableName}/upstream:
    parameters:
      - name: schemaName
        in: path
        required: true
        description: Name of the database schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
      - name: tableName
        in: path
        required: true
        description: Name of the table within the schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
    get:
      operationId: getUpstreamLineage
      summary: Get upstream lineage for a table
      description: Returns the upstream lineage edges representing data sources that feed into the specified table.
      tags: [Lineage]
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Upstream lineage edges
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PaginatedLineageEdges'
              example:
                data:
                  - id: 1
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '429':
          description: Rate limit exceeded. Retry after the indicated duration.
          headers:
            Retry-After:
              description: Seconds to wait before retrying the request.
              schema:
                type: integer
                minimum: 1
                maximum: 3600
                format: int32
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 429
                message: "Rate limit exceeded, retry after 30 seconds"
        '500':
          description: An unexpected internal server error occurred.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 500
                message: "An unexpected error occurred"
        '401':
          description: Unauthorized
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 401
                message: "Authentication required"
        '404':
          description: Not found
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 404
                message: "Resource not found"

  /lineage/tables/{schemaName}/{tableName}/downstream:
    parameters:
      - name: schemaName
        in: path
        required: true
        description: Name of the database schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
      - name: tableName
        in: path
        required: true
        description: Name of the table within the schema.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
    get:
      operationId: getDownstreamLineage
      summary: Get downstream lineage for a table
      description: Returns the downstream lineage edges representing tables and views that depend on the specified table.
      tags: [Lineage]
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Downstream lineage edges
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PaginatedLineageEdges'
              example:
                data:
                  - id: 1
                    source_table: "raw_events"
                    target_table: "page_views"
                    source_schema: "main"
                    target_schema: "analytics"
                    edge_type: READ
                    principal_name: "etl-service"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '429':
          description: Rate limit exceeded. Retry after the indicated duration.
          headers:
            Retry-After:
              description: Seconds to wait before retrying the request.
              schema:
                type: integer
                minimum: 1
                maximum: 3600
                format: int32
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 429
                message: "Rate limit exceeded, retry after 30 seconds"
        '500':
          description: An unexpected internal server error occurred.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 500
                message: "An unexpected error occurred"
        '401':
          description: Unauthorized
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 401
                message: "Authentication required"
        '404':
          description: Not found
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 404
                message: "Resource not found"

  /lineage/edges/{edgeId}:
    parameters:
      - name: edgeId
        in: path
        required: true
        description: Unique identifier of the lineage edge.
        schema:
          type: integer
          format: int64
          minimum: 1
          maximum: 9223372036854775807
    delete:
      operationId: deleteLineageEdge
      summary: Delete a lineage edge
      description: Permanently removes a lineage edge by its identifier.
      tags: [Lineage]
      responses:
        '204':
          description: Edge deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '429':
          description: Rate limit exceeded. Retry after the indicated duration.
          headers:
            Retry-After:
              description: Seconds to wait before retrying the request.
              schema:
                type: integer
                minimum: 1
                maximum: 3600
                format: int32
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 429
                message: "Rate limit exceeded, retry after 30 seconds"
        '500':
          description: An unexpected internal server error occurred.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 500
                message: "An unexpected error occurred"
        '401':
          description: Unauthorized
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 401
                message: "Authentication required"
        '403':
          description: Access denied
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 403
                message: "Insufficient privileges to perform this operation"
        '404':
          description: Not found
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 404
                message: "Resource not found"

  /lineage/purge:
    post:
      operationId: purgeLineage
      summary: Purge old lineage edges
      tags: [Lineage]
      description: Delete lineage edges older than the specified number of days.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/lineage.yaml#/PurgeLineageRequest'
            example:
              older_than_days: 90
      responses:
        '200':
          description: Purge result
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/lineage.yaml#/PurgeLineageResponse'
              example:
                deleted_count: 42
        '400':
          description: Invalid request parameters or malformed request body.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 400
                message: "Invalid request: field 'name' is required"
        '429':
          description: Rate limit exceeded. Retry after the indicated duration.
          headers:
            Retry-After:
              description: Seconds to wait before retrying the request.
              schema:
                type: integer
                minimum: 1
                maximum: 3600
                format: int32
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 429
                message: "Rate limit exceeded, retry after 30 seconds"
        '500':
          description: An unexpected internal server error occurred.
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 500
                message: "An unexpected error occurred"
        '401':
          description: Unauthorized
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 401
                message: "Authentication required"
        '403':
          description: Access denied
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/common.yaml#/Error'
              example:
                code: 403
                message: "Insufficient privileges to perform this operation"
