paths:
  /search:
    get:
      operationId: searchCatalog
      summary: Search catalog objects
      tags: [Governance]
      description: Full-text search across schemas, tables, and columns.
      parameters:
        - name: query
          in: query
          required: true
          description: Search query string to match against catalog objects.
          schema:
            type: string
            maxLength: 1024
            pattern: '[\s\S]+'
        - name: type
          in: query
          description: "Filter by object type: schema, table, or column"
          schema:
            type: string
            maxLength: 64
            pattern: '^\S+$'
        - name: catalog
          in: query
          description: Scope search to a specific catalog (defaults to the default catalog).
          schema:
            type: string
            maxLength: 255
            pattern: '^\S+$'
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Search results
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/governance.yaml#/PaginatedSearchResults'
              example:
                data:
                  - type: "table"
                    name: "users"
                    schema_name: "main"
                    table_name: "users"
                    comment: "Core user accounts table"
                    match_field: "name"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /tags:
    get:
      operationId: listTags
      summary: List all tags
      tags: [Governance]
      description: Returns a paginated list of all tags defined in the catalog.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of tags
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/governance.yaml#/PaginatedTags'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    key: "pii"
                    value: "email"
                    created_by: "admin"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    post:
      operationId: createTag
      summary: Create a tag
      tags: [Governance]
      description: Creates a new tag for classifying and annotating catalog objects.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/governance.yaml#/CreateTagRequest'
            example:
              key: "pii"
              value: "email"
      responses:
        '201':
          description: Created tag
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/governance.yaml#/Tag'
              example:
                id: "550e8400-e29b-41d4-a716-446655440001"
                key: "pii"
                value: "email"
                created_by: "admin"
                created_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '409':
          $ref: '../schemas/responses.yaml#/responses/Conflict'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /tags/{tagId}:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/tagId'
    delete:
      operationId: deleteTag
      summary: Delete a tag
      tags: [Governance]
      description: Permanently deletes a tag and all of its assignments from the catalog.
      responses:
        '204':
          description: Tag deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /tags/{tagId}/assignments:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/tagId'
    post:
      operationId: createTagAssignment
      summary: Assign a tag to a securable object
      tags: [Governance]
      description: Creates an assignment linking a tag to a specific securable catalog object.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/governance.yaml#/CreateTagAssignmentRequest'
            example:
              securable_type: "table"
              securable_id: "550e8400-e29b-41d4-a716-446655440005"
              column_name: "email"
      responses:
        '201':
          description: Tag assigned
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/governance.yaml#/TagAssignment'
              example:
                id: "550e8400-e29b-41d4-a716-446655440001"
                tag_id: "550e8400-e29b-41d4-a716-446655440001"
                securable_type: "table"
                securable_id: "550e8400-e29b-41d4-a716-446655440005"
                column_name: "email"
                assigned_by: "admin"
                assigned_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '409':
          $ref: '../schemas/responses.yaml#/responses/Conflict'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /tag-assignments/{assignmentId}:
    parameters:
      - $ref: '../schemas/responses.yaml#/parameters/assignmentId'
    delete:
      operationId: deleteTagAssignment
      summary: Remove a tag assignment
      tags: [Governance]
      description: Removes a tag assignment, unlinking the tag from the securable object.
      responses:
        '204':
          description: Tag unassigned
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /classifications:
    get:
      operationId: listClassifications
      summary: List classification and sensitivity tags
      tags: [Governance]
      description: Returns all tags with governed classification/sensitivity prefixes.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Classification tags
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/governance.yaml#/PaginatedTags'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440001"
                    key: "pii"
                    value: "email"
                    created_by: "admin"
                    created_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
