paths:
  /macros:
    get:
      operationId: listMacros
      summary: List SQL macros
      tags: [Models]
      description: Returns a paginated list of SQL macros.
      parameters:
        - $ref: '../schemas/common.yaml#/parameters/MaxResults'
        - $ref: '../schemas/common.yaml#/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of macros
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/macros.yaml#/PaginatedMacros'
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440200"
                    name: "cents_to_dollars"
                    macro_type: "SCALAR"
                    parameters: ["amount"]
                    body: "amount / 100.0"
                    description: "Converts cents to dollars"
                    created_by: "admin"
                    created_at: "2025-01-15T09:30:00Z"
                    updated_at: "2025-01-15T09:30:00Z"
                next_page_token: "eyJpZCI6MTB9"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    post:
      operationId: createMacro
      summary: Create a SQL macro
      tags: [Models]
      description: Creates a new DuckDB SQL macro definition.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/macros.yaml#/CreateMacroRequest'
            example:
              name: "cents_to_dollars"
              macro_type: "SCALAR"
              parameters: ["amount"]
              body: "amount / 100.0"
              description: "Converts cents to dollars"
      responses:
        '201':
          description: Created macro
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/macros.yaml#/Macro'
              example:
                id: "550e8400-e29b-41d4-a716-446655440200"
                name: "cents_to_dollars"
                macro_type: "SCALAR"
                parameters: ["amount"]
                body: "amount / 100.0"
                description: "Converts cents to dollars"
                created_by: "admin"
                created_at: "2025-01-15T09:30:00Z"
                updated_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '409':
          $ref: '../schemas/responses.yaml#/responses/Conflict'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'

  /macros/{macroName}:
    parameters:
      - name: macroName
        in: path
        required: true
        description: The name of the macro.
        schema:
          type: string
          maxLength: 255
          pattern: '^\S+$'
    get:
      operationId: getMacro
      summary: Get a SQL macro
      tags: [Models]
      description: Retrieves a SQL macro by name.
      responses:
        '200':
          description: Macro detail
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/macros.yaml#/Macro'
              example:
                id: "550e8400-e29b-41d4-a716-446655440200"
                name: "cents_to_dollars"
                macro_type: "SCALAR"
                parameters: ["amount"]
                body: "amount / 100.0"
                description: "Converts cents to dollars"
                created_by: "admin"
                created_at: "2025-01-15T09:30:00Z"
                updated_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    patch:
      operationId: updateMacro
      summary: Update a SQL macro
      tags: [Models]
      description: Updates an existing SQL macro.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas/macros.yaml#/UpdateMacroRequest'
            example:
              body: "amount / 100.0"
              description: "Updated description"
      responses:
        '200':
          description: Updated macro
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
          content:
            application/json:
              schema:
                $ref: '../schemas/macros.yaml#/Macro'
              example:
                id: "550e8400-e29b-41d4-a716-446655440200"
                name: "cents_to_dollars"
                macro_type: "SCALAR"
                parameters: ["amount"]
                body: "amount / 100.0"
                description: "Updated description"
                created_by: "admin"
                created_at: "2025-01-15T09:30:00Z"
                updated_at: "2025-01-15T09:30:00Z"
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
    delete:
      operationId: deleteMacro
      summary: Delete a SQL macro
      tags: [Models]
      description: Deletes a SQL macro.
      responses:
        '204':
          description: Macro deleted
          headers:
            X-RateLimit-Limit:
              description: Maximum requests allowed in the current window.
              schema:
                type: integer
                minimum: 1
                maximum: 1000000
                format: int32
            X-RateLimit-Remaining:
              description: Requests remaining in the current window.
              schema:
                type: integer
                minimum: 0
                maximum: 1000000
                format: int32
            X-RateLimit-Reset:
              description: UTC epoch seconds when the rate limit resets.
              schema:
                type: integer
                minimum: 0
                maximum: 4102444800
                format: int64
        '400':
          $ref: '../schemas/responses.yaml#/responses/BadRequest'
        '401':
          $ref: '../schemas/responses.yaml#/responses/Unauthorized'
        '403':
          $ref: '../schemas/responses.yaml#/responses/Forbidden'
        '404':
          $ref: '../schemas/responses.yaml#/responses/NotFound'
        '429':
          $ref: '../schemas/responses.yaml#/responses/RateLimitExceeded'
        '500':
          $ref: '../schemas/responses.yaml#/responses/InternalError'
