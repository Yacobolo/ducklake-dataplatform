openapi: "3.0.3"
info:
  title: DuckDB Data Platform API
  version: "2.0.0"
  description: |
    HTTP API for the DuckDB data platform with RBAC, RLS, column masking,
    and Unity Catalog-compatible catalog management.

servers:
  - url: /v1

security:
  - BearerAuth: []
  - ApiKeyAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

  parameters:
    MaxResults:
      name: max_results
      in: query
      description: Maximum number of results to return per page.
      required: false
      schema:
        type: integer
        default: 100
        maximum: 1000
    PageToken:
      name: page_token
      in: query
      description: Opaque pagination token from a previous response.
      required: false
      schema:
        type: string

  schemas:
    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: integer
        message:
          type: string

    # --- Query ---
    QueryRequest:
      type: object
      required: [sql]
      properties:
        sql:
          type: string

    QueryResult:
      type: object
      properties:
        columns:
          type: array
          items:
            type: string
        rows:
          type: array
          items:
            type: array
            items: {}
        row_count:
          type: integer

    # --- Principals ---
    Principal:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string
        is_admin:
          type: boolean
        created_at:
          type: string
          format: date-time

    CreatePrincipalRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        type:
          type: string
          default: user
        is_admin:
          type: boolean
          default: false

    SetAdminRequest:
      type: object
      required: [is_admin]
      properties:
        is_admin:
          type: boolean

    PaginatedPrincipals:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Principal'
        next_page_token:
          type: string

    # --- Groups ---
    Group:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time

    CreateGroupRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    GroupMember:
      type: object
      properties:
        group_id:
          type: integer
          format: int64
        member_type:
          type: string
        member_id:
          type: integer
          format: int64

    AddGroupMemberRequest:
      type: object
      required: [member_type, member_id]
      properties:
        member_type:
          type: string
        member_id:
          type: integer
          format: int64

    PaginatedGroups:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Group'
        next_page_token:
          type: string

    PaginatedGroupMembers:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/GroupMember'
        next_page_token:
          type: string

    # --- Grants ---
    PrivilegeGrant:
      type: object
      properties:
        id:
          type: integer
          format: int64
        principal_id:
          type: integer
          format: int64
        principal_type:
          type: string
        securable_type:
          type: string
        securable_id:
          type: integer
          format: int64
        privilege:
          type: string
        granted_by:
          type: integer
          format: int64
          nullable: true
        granted_at:
          type: string
          format: date-time

    GrantRequest:
      type: object
      required: [principal_id, principal_type, securable_type, securable_id, privilege]
      properties:
        principal_id:
          type: integer
          format: int64
        principal_type:
          type: string
        securable_type:
          type: string
        securable_id:
          type: integer
          format: int64
        privilege:
          type: string

    RevokeRequest:
      type: object
      required: [principal_id, principal_type, securable_type, securable_id, privilege]
      properties:
        principal_id:
          type: integer
          format: int64
        principal_type:
          type: string
        securable_type:
          type: string
        securable_id:
          type: integer
          format: int64
        privilege:
          type: string

    PaginatedGrants:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PrivilegeGrant'
        next_page_token:
          type: string

    # --- Row Filters ---
    RowFilter:
      type: object
      properties:
        id:
          type: integer
          format: int64
        table_id:
          type: integer
          format: int64
        filter_sql:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time

    CreateRowFilterRequest:
      type: object
      required: [filter_sql]
      properties:
        filter_sql:
          type: string
        description:
          type: string

    BindingRequest:
      type: object
      required: [principal_id, principal_type]
      properties:
        principal_id:
          type: integer
          format: int64
        principal_type:
          type: string

    PaginatedRowFilters:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/RowFilter'
        next_page_token:
          type: string

    # --- Column Masks ---
    ColumnMask:
      type: object
      properties:
        id:
          type: integer
          format: int64
        table_id:
          type: integer
          format: int64
        column_name:
          type: string
        mask_expression:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time

    CreateColumnMaskRequest:
      type: object
      required: [column_name, mask_expression]
      properties:
        column_name:
          type: string
        mask_expression:
          type: string
        description:
          type: string

    ColumnMaskBindingRequest:
      type: object
      required: [principal_id, principal_type]
      properties:
        principal_id:
          type: integer
          format: int64
        principal_type:
          type: string
        see_original:
          type: boolean
          default: false

    PaginatedColumnMasks:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ColumnMask'
        next_page_token:
          type: string

    # --- Legacy Introspection (deprecated) ---
    Schema:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string

    Table:
      type: object
      properties:
        id:
          type: integer
          format: int64
        schema_id:
          type: integer
          format: int64
        name:
          type: string

    Column:
      type: object
      properties:
        id:
          type: integer
          format: int64
        table_id:
          type: integer
          format: int64
        name:
          type: string
        type:
          type: string

    PaginatedSchemas:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Schema'
        next_page_token:
          type: string

    PaginatedTables:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Table'
        next_page_token:
          type: string

    PaginatedColumns:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Column'
        next_page_token:
          type: string

    # --- Audit ---
    AuditEntry:
      type: object
      properties:
        id:
          type: integer
          format: int64
        principal_name:
          type: string
        action:
          type: string
        statement_type:
          type: string
          nullable: true
        original_sql:
          type: string
          nullable: true
        rewritten_sql:
          type: string
          nullable: true
        tables_accessed:
          type: array
          items:
            type: string
        status:
          type: string
        error_message:
          type: string
          nullable: true
        duration_ms:
          type: integer
          format: int64
          nullable: true
        created_at:
          type: string
          format: date-time

    PaginatedAuditLogs:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AuditEntry'
        next_page_token:
          type: string

    # --- Manifest ---
    ManifestRequest:
      type: object
      required: [table]
      properties:
        table:
          type: string
        schema:
          type: string
          default: main

    ManifestColumn:
      type: object
      properties:
        name:
          type: string
        type:
          type: string

    ManifestResponse:
      type: object
      properties:
        table:
          type: string
        schema:
          type: string
        columns:
          type: array
          items:
            $ref: '#/components/schemas/ManifestColumn'
        files:
          type: array
          items:
            type: string
        row_filters:
          type: array
          items:
            type: string
        column_masks:
          type: object
          additionalProperties:
            type: string
        expires_at:
          type: string
          format: date-time

    # --- Catalog Management ---
    CatalogInfo:
      type: object
      properties:
        name:
          type: string
        comment:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SchemaDetail:
      type: object
      properties:
        schema_id:
          type: integer
          format: int64
        name:
          type: string
        catalog_name:
          type: string
        comment:
          type: string
        properties:
          type: object
          additionalProperties:
            type: string
        owner:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateSchemaRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        comment:
          type: string
        properties:
          type: object
          additionalProperties:
            type: string

    UpdateSchemaRequest:
      type: object
      properties:
        comment:
          type: string
        properties:
          type: object
          additionalProperties:
            type: string

    PaginatedSchemaDetails:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/SchemaDetail'
        next_page_token:
          type: string

    TableDetail:
      type: object
      properties:
        table_id:
          type: integer
          format: int64
        name:
          type: string
        schema_name:
          type: string
        catalog_name:
          type: string
        table_type:
          type: string
        columns:
          type: array
          items:
            $ref: '#/components/schemas/ColumnDetail'
        comment:
          type: string
        properties:
          type: object
          additionalProperties:
            type: string
        owner:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ColumnDetail:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        position:
          type: integer
        comment:
          type: string

    CreateTableApiRequest:
      type: object
      required: [name, columns]
      properties:
        name:
          type: string
        columns:
          type: array
          items:
            $ref: '#/components/schemas/CreateColumnDef'
        comment:
          type: string

    CreateColumnDef:
      type: object
      required: [name, type]
      properties:
        name:
          type: string
        type:
          type: string

    PaginatedTableDetails:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/TableDetail'
        next_page_token:
          type: string

    PaginatedColumnDetails:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ColumnDetail'
        next_page_token:
          type: string

    MetastoreSummary:
      type: object
      properties:
        catalog_name:
          type: string
        metastore_type:
          type: string
        storage_backend:
          type: string
        data_path:
          type: string
        schema_count:
          type: integer
          format: int64
        table_count:
          type: integer
          format: int64

paths:
  # === Query ===
  /query:
    post:
      operationId: executeQuery
      summary: Execute SQL as authenticated principal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
      responses:
        '200':
          description: Query result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryResult'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # === Principals ===
  /principals:
    get:
      operationId: listPrincipals
      summary: List all principals
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of principals
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPrincipals'
    post:
      operationId: createPrincipal
      summary: Create a principal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePrincipalRequest'
      responses:
        '201':
          description: Created principal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Principal'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /principals/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: getPrincipal
      summary: Get principal by ID
      responses:
        '200':
          description: Principal details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Principal'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: deletePrincipal
      summary: Delete a principal
      responses:
        '204':
          description: Deleted
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /principals/{id}/admin:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    put:
      operationId: setAdmin
      summary: Set or unset admin flag
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetAdminRequest'
      responses:
        '204':
          description: Updated
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # === Groups ===
  /groups:
    get:
      operationId: listGroups
      summary: List all groups
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of groups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedGroups'
    post:
      operationId: createGroup
      summary: Create a group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
      responses:
        '201':
          description: Created group
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'

  /groups/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: getGroup
      summary: Get group by ID
      responses:
        '200':
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: deleteGroup
      summary: Delete a group
      responses:
        '204':
          description: Deleted

  /groups/{id}/members:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: listGroupMembers
      summary: List group members
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedGroupMembers'
    post:
      operationId: addGroupMember
      summary: Add member to group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddGroupMemberRequest'
      responses:
        '204':
          description: Member added
    delete:
      operationId: removeGroupMember
      summary: Remove member from group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddGroupMemberRequest'
      responses:
        '204':
          description: Member removed

  # === Grants ===
  /grants:
    get:
      operationId: listGrants
      summary: List grants
      parameters:
        - name: principal_id
          in: query
          schema:
            type: integer
            format: int64
        - name: principal_type
          in: query
          schema:
            type: string
        - name: securable_type
          in: query
          schema:
            type: string
        - name: securable_id
          in: query
          schema:
            type: integer
            format: int64
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of grants
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedGrants'
    post:
      operationId: grantPrivilege
      summary: Grant a privilege
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GrantRequest'
      responses:
        '201':
          description: Granted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrivilegeGrant'
    delete:
      operationId: revokePrivilege
      summary: Revoke a privilege
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RevokeRequest'
      responses:
        '204':
          description: Revoked

  # === Row Filters ===
  /tables/{tableId}/row-filters:
    parameters:
      - name: tableId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: listRowFilters
      summary: List row filters for table
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of filters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedRowFilters'
    post:
      operationId: createRowFilter
      summary: Create row filter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRowFilterRequest'
      responses:
        '201':
          description: Created filter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RowFilter'

  /row-filters/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    delete:
      operationId: deleteRowFilter
      summary: Delete row filter
      responses:
        '204':
          description: Deleted

  /row-filters/{id}/bindings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    post:
      operationId: bindRowFilter
      summary: Bind filter to principal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BindingRequest'
      responses:
        '204':
          description: Bound
    delete:
      operationId: unbindRowFilter
      summary: Unbind filter
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BindingRequest'
      responses:
        '204':
          description: Unbound

  # === Column Masks ===
  /tables/{tableId}/column-masks:
    parameters:
      - name: tableId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: listColumnMasks
      summary: List column masks
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of masks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedColumnMasks'
    post:
      operationId: createColumnMask
      summary: Create column mask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateColumnMaskRequest'
      responses:
        '201':
          description: Created mask
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ColumnMask'

  /column-masks/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    delete:
      operationId: deleteColumnMask
      summary: Delete column mask
      responses:
        '204':
          description: Deleted

  /column-masks/{id}/bindings:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    post:
      operationId: bindColumnMask
      summary: Bind mask to principal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ColumnMaskBindingRequest'
      responses:
        '204':
          description: Bound
    delete:
      operationId: unbindColumnMask
      summary: Unbind mask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BindingRequest'
      responses:
        '204':
          description: Unbound

  # === Legacy Introspection (deprecated) ===
  /schemas:
    get:
      operationId: listSchemas
      summary: List DuckLake schemas (deprecated, use /catalog/schemas)
      deprecated: true
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of schemas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSchemas'

  /schemas/{id}/tables:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: listTables
      summary: List tables in schema (deprecated, use /catalog/schemas/{name}/tables)
      deprecated: true
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of tables
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedTables'

  /tables/{id}/columns:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      operationId: listColumns
      summary: List columns in table (deprecated, use /catalog/schemas/{name}/tables/{name}/columns)
      deprecated: true
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of columns
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedColumns'

  # === Manifest ===
  /manifest:
    post:
      operationId: getManifest
      summary: Get table manifest with presigned URLs and security policies
      description: >
        Returns presigned S3 URLs for the Parquet files backing a table,
        along with RLS row filters and column masks for the authenticated
        principal. Used by the duck_access DuckDB extension for secure
        client-side querying.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManifestRequest'
      responses:
        '200':
          description: Manifest with presigned URLs and security policies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManifestResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Table not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # === Audit Logs ===
  /audit-logs:
    get:
      operationId: listAuditLogs
      summary: Query audit logs
      parameters:
        - name: principal_name
          in: query
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated audit log entries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAuditLogs'

  # === Catalog Management ===
  /catalog:
    get:
      operationId: getCatalog
      summary: Get catalog info
      description: Returns information about the single DuckLake catalog.
      responses:
        '200':
          description: Catalog information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogInfo'

  /catalog/schemas:
    get:
      operationId: listCatalogSchemas
      summary: List schemas in the catalog
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of schemas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedSchemaDetails'
    post:
      operationId: createSchema
      summary: Create a new schema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSchemaRequest'
      responses:
        '201':
          description: Schema created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaDetail'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Schema already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/schemas/{schemaName}:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
    get:
      operationId: getSchemaByName
      summary: Get a schema by name
      responses:
        '200':
          description: Schema details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaDetail'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      operationId: updateSchemaMetadata
      summary: Update schema metadata (comment, properties)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSchemaRequest'
      responses:
        '200':
          description: Updated schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaDetail'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: deleteSchema
      summary: Delete a schema
      parameters:
        - name: force
          in: query
          description: Force deletion even if the schema contains tables.
          required: false
          schema:
            type: boolean
      responses:
        '204':
          description: Schema deleted
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/schemas/{schemaName}/tables:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
    get:
      operationId: listCatalogTables
      summary: List tables in a schema
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of tables
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedTableDetails'
        '404':
          description: Schema not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      operationId: createCatalogTable
      summary: Create a new table in a schema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTableApiRequest'
      responses:
        '201':
          description: Table created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TableDetail'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Table already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/schemas/{schemaName}/tables/{tableName}:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
      - name: tableName
        in: path
        required: true
        schema:
          type: string
    get:
      operationId: getTableByName
      summary: Get a table by name
      responses:
        '200':
          description: Table details including columns
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TableDetail'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      operationId: dropTable
      summary: Delete a table
      responses:
        '204':
          description: Table deleted
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /catalog/schemas/{schemaName}/tables/{tableName}/columns:
    parameters:
      - name: schemaName
        in: path
        required: true
        schema:
          type: string
      - name: tableName
        in: path
        required: true
        schema:
          type: string
    get:
      operationId: listTableColumns
      summary: List columns of a table
      parameters:
        - $ref: '#/components/parameters/MaxResults'
        - $ref: '#/components/parameters/PageToken'
      responses:
        '200':
          description: Paginated list of columns
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedColumnDetails'
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # === Metastore ===
  /metastore/summary:
    get:
      operationId: getMetastoreSummary
      summary: Get metastore summary
      description: Returns high-level information about the DuckLake metastore.
      responses:
        '200':
          description: Metastore summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetastoreSummary'
