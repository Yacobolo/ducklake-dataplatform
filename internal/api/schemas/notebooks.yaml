Notebook:
  description: A SQL notebook document.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
    owner:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    created_at:
      type: string
      format: date-time
      maxLength: 64
    updated_at:
      type: string
      format: date-time
      maxLength: 64

Cell:
  description: A single cell within a notebook.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    notebook_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    cell_type:
      type: string
      enum: [sql, markdown]
    content:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
    position:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
    last_result:
      type: string
      description: JSON-encoded cached result from last execution
      maxLength: 10485760
      pattern: '^[\s\S]*$'
    created_at:
      type: string
      format: date-time
      maxLength: 64
    updated_at:
      type: string
      format: date-time
      maxLength: 64

NotebookDetail:
  description: A notebook with its cells.
  type: object
  properties:
    notebook:
      $ref: '#/Notebook'
    cells:
      type: array
      maxItems: 10000
      items:
        $ref: '#/Cell'

PaginatedNotebooks:
  description: A paginated list of notebooks.
  type: object
  properties:
    data:
      type: array
      maxItems: 1000
      items:
        $ref: '#/Notebook'
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'

CreateNotebookRequest:
  description: Request payload for creating a new notebook.
  type: object
  additionalProperties: false
  required: [name]
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'

UpdateNotebookRequest:
  description: Request payload for updating a notebook.
  type: object
  additionalProperties: false
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'

CreateCellRequest:
  description: Request payload for creating a new cell.
  type: object
  additionalProperties: false
  required: [cell_type]
  properties:
    cell_type:
      type: string
      enum: [sql, markdown]
    content:
      type: string
      maxLength: 65536
      default: ''
      pattern: '^[\s\S]*$'
    position:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
      description: Position in the notebook. If omitted, appends to end.

UpdateCellRequest:
  description: Request payload for updating a cell.
  type: object
  additionalProperties: false
  properties:
    content:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
    position:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647

ReorderCellsRequest:
  description: Request payload for reordering cells in a notebook.
  type: object
  additionalProperties: false
  required: [cell_ids]
  properties:
    cell_ids:
      type: array
      minItems: 1
      maxItems: 10000
      items:
        type: string
        pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
        maxLength: 36

NotebookSession:
  description: An active notebook execution session.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    notebook_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    principal:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    state:
      type: string
      enum: [active, closed]
    created_at:
      type: string
      format: date-time
      maxLength: 64
    last_used_at:
      type: string
      format: date-time
      maxLength: 64

CellExecutionResult:
  description: Result of executing a single cell.
  type: object
  properties:
    cell_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    columns:
      type: array
      maxItems: 10000
      items:
        type: string
        maxLength: 255
        pattern: '^[\s\S]*$'
    rows:
      type: array
      maxItems: 1000000
      items:
        type: array
        maxItems: 10000
        items: {}
    row_count:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
    error:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
    duration_ms:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807

RunAllResult:
  description: Aggregated result from executing all cells in a notebook.
  type: object
  properties:
    notebook_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    results:
      type: array
      maxItems: 10000
      items:
        $ref: '#/CellExecutionResult'
    total_duration_ms:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807

NotebookJob:
  description: An async notebook execution job.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    notebook_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    session_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    state:
      type: string
      enum: [pending, running, complete, failed]
    result:
      type: string
      description: JSON-encoded RunAllResult when complete
      maxLength: 10485760
      pattern: '^[\s\S]*$'
    error:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
    created_at:
      type: string
      format: date-time
      maxLength: 64
    updated_at:
      type: string
      format: date-time
      maxLength: 64

PaginatedNotebookJobs:
  description: A paginated list of notebook jobs.
  type: object
  properties:
    data:
      type: array
      maxItems: 1000
      items:
        $ref: '#/NotebookJob'
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'

GitRepo:
  description: A registered Git repository for notebook sync.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
    url:
      type: string
      maxLength: 2048
      format: uri
    branch:
      type: string
      maxLength: 255
      pattern: '^[\w./-]+$'
    path:
      type: string
      maxLength: 1024
      pattern: '^[\w./-]*$'
    owner:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    last_sync_at:
      type: string
      format: date-time
      maxLength: 64
    last_commit:
      type: string
      maxLength: 64
      pattern: '^[0-9a-f]+$'
    created_at:
      type: string
      format: date-time
      maxLength: 64
    updated_at:
      type: string
      format: date-time
      maxLength: 64

CreateGitRepoRequest:
  description: Request payload for registering a Git repository.
  type: object
  additionalProperties: false
  required: [url, branch, auth_token]
  properties:
    url:
      type: string
      maxLength: 2048
      format: uri
    branch:
      type: string
      maxLength: 255
      default: main
      pattern: '^[\w./-]+$'
    path:
      type: string
      maxLength: 1024
      default: ''
      pattern: '^[\w./-]*$'
    auth_token:
      type: string
      maxLength: 512
      description: Personal access token or deploy key for Git authentication.
      pattern: '^\S+$'

PaginatedGitRepos:
  description: A paginated list of Git repositories.
  type: object
  properties:
    data:
      type: array
      maxItems: 1000
      items:
        $ref: '#/GitRepo'
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'

GitSyncResult:
  description: Result of a Git sync operation.
  type: object
  properties:
    notebooks_created:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
    notebooks_updated:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
    notebooks_deleted:
      type: integer
      format: int32
      minimum: 0
      maximum: 2147483647
    commit_sha:
      type: string
      maxLength: 64
      pattern: '^[0-9a-f]+$'
