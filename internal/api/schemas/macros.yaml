Macro:
  description: A DuckDB SQL macro definition.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: 550e8400-e29b-41d4-a716-446655440200
    name:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: cents_to_dollars
    macro_type:
      type: string
      enum: [SCALAR, TABLE]
      example: SCALAR
    parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: "amount / 100.0"
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: Converts cents to dollars
    catalog_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: memory
    project_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: analytics
    visibility:
      type: string
      enum: [project, catalog_global, system]
      example: project
    owner:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: data-platform
    properties:
      type: object
      additionalProperties:
        type: string
        maxLength: 4096
        pattern: '^[\s\S]*$'
      example:
        team: analytics
    tags:
      type: array
      items:
        type: string
        maxLength: 255
        pattern: '^[\S].*$'
      maxItems: 100
      example: ["finance", "shared"]
    status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: ACTIVE
    created_by:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: admin
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: "2025-01-15T09:30:00Z"
    updated_at:
      type: string
      format: date-time
      maxLength: 64
      example: "2025-01-15T09:30:00Z"

CreateMacroRequest:
  description: Request payload for creating a new SQL macro.
  type: object
  additionalProperties: false
  required: [name, body]
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: cents_to_dollars
    macro_type:
      type: string
      enum: [SCALAR, TABLE]
      example: SCALAR
    parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: "amount / 100.0"
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: Converts cents to dollars
    catalog_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: memory
    project_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: analytics
    visibility:
      type: string
      enum: [project, catalog_global, system]
      example: project
    owner:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: data-platform
    properties:
      type: object
      additionalProperties:
        type: string
        maxLength: 4096
        pattern: '^[\s\S]*$'
      example:
        team: analytics
    tags:
      type: array
      items:
        type: string
        maxLength: 255
        pattern: '^[\S].*$'
      maxItems: 100
      example: ["finance", "shared"]
    status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: ACTIVE

UpdateMacroRequest:
  description: Request payload for updating an existing SQL macro.
  type: object
  additionalProperties: false
  properties:
    body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: "amount / 100.0"
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: Updated description
    parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: DEPRECATED
    catalog_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: main
    project_name:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: analytics
    visibility:
      type: string
      enum: [project, catalog_global, system]
      example: catalog_global
    owner:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: data-platform
    properties:
      type: object
      additionalProperties:
        type: string
        maxLength: 4096
        pattern: '^[\s\S]*$'
      example:
        team: finance
    tags:
      type: array
      maxItems: 1000
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: [gold, pii_safe]

MacroRevision:
  description: Immutable revision snapshot for a macro definition.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: 550e8400-e29b-41d4-a716-446655440201
    macro_name:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: cents_to_dollars
    version:
      type: integer
      format: int32
      minimum: 1
      maximum: 999999
      example: 2
    content_hash:
      type: string
      maxLength: 128
      pattern: '^sha256:[0-9a-f]+$'
      example: sha256:abcdef012345
    parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: amount / 100.0
    description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: Converts cents to dollars
    status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: ACTIVE
    created_by:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: admin
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: "2025-01-15T09:30:00Z"

MacroRevisionList:
  description: Revision history for a macro.
  type: object
  properties:
    data:
      type: array
      maxItems: 10000
      items:
        $ref: '#/MacroRevision'
      example: []

MacroRevisionDiff:
  description: Semantic difference between two macro revisions.
  type: object
  properties:
    macro_name:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: cents_to_dollars
    from_version:
      type: integer
      format: int32
      minimum: 1
      maximum: 999999
      example: 1
    to_version:
      type: integer
      format: int32
      minimum: 1
      maximum: 999999
      example: 2
    from_content_hash:
      type: string
      maxLength: 128
      pattern: '^sha256:[0-9a-f]+$'
      example: sha256:aaaa
    to_content_hash:
      type: string
      maxLength: 128
      pattern: '^sha256:[0-9a-f]+$'
      example: sha256:bbbb
    changed:
      type: boolean
      example: true
    parameters_changed:
      type: boolean
      example: false
    body_changed:
      type: boolean
      example: true
    description_changed:
      type: boolean
      example: false
    status_changed:
      type: boolean
      example: false
    from_parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    to_parameters:
      type: array
      maxItems: 50
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
      example: ["amount"]
    from_body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: amount / 100
    to_body:
      type: string
      maxLength: 65536
      pattern: '^[\s\S]*$'
      example: amount / 100.0
    from_description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: old description
    to_description:
      type: string
      maxLength: 4096
      pattern: '^[\s\S]*$'
      example: new description
    from_status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: ACTIVE
    to_status:
      type: string
      enum: [ACTIVE, DEPRECATED]
      example: DEPRECATED
    impact_changed:
      type: boolean
      description: Whether reverse impacted models changed between revisions.
      example: true
    impacted_models_added:
      type: array
      maxItems: 10000
      items:
        $ref: '#/MacroImpactModel'
      example: []
    impacted_models_removed:
      type: array
      maxItems: 10000
      items:
        $ref: '#/MacroImpactModel'
      example: []
    impacted_models_unchanged:
      type: array
      maxItems: 10000
      items:
        $ref: '#/MacroImpactModel'
      example: []

MacroImpactModel:
  description: A model relation affected by a macro usage.
  type: object
  properties:
    model_name:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: analytics.fct_orders
    target_schema:
      type: string
      maxLength: 255
      pattern: '^[\S]*$'
      example: analytics
    target_table:
      type: string
      maxLength: 1024
      pattern: '^\S+$'
      example: analytics.fct_orders
    last_seen_at:
      type: string
      format: date-time
      maxLength: 64
      example: "2025-01-15T09:30:00Z"

MacroImpactList:
  description: Paginated reverse impact view for macro consumers.
  type: object
  properties:
    data:
      type: array
      maxItems: 10000
      items:
        $ref: '#/MacroImpactModel'
      example: []
    next_page_token:
      type: string
      maxLength: 1024
      pattern: '^[\S]*$'
      example: "eyJpZCI6MTB9"

PaginatedMacros:
  description: Paginated list of macros.
  type: object
  properties:
    data:
      type: array
      maxItems: 10000
      items:
        $ref: '#/Macro'
      example:
        - id: "550e8400-e29b-41d4-a716-446655440200"
          name: "cents_to_dollars"
          macro_type: "SCALAR"
          parameters: ["amount"]
          body: "amount / 100.0"
          description: "Converts cents to dollars"
          created_by: "admin"
          created_at: "2025-01-15T09:30:00Z"
          updated_at: "2025-01-15T09:30:00Z"
    next_page_token:
      type: string
      maxLength: 1024
      pattern: '^[\S]*$'
      example: "eyJpZCI6MTB9"
