Principal:
  type: object
  properties:
    id:
      type: integer
      format: int64
    name:
      type: string
    type:
      type: string
    is_admin:
      type: boolean
    created_at:
      type: string
      format: date-time

CreatePrincipalRequest:
  type: object
  required: [name]
  properties:
    name:
      type: string
    type:
      type: string
      default: user
    is_admin:
      type: boolean
      default: false

UpdatePrincipalAdminRequest:
  type: object
  required: [is_admin]
  properties:
    is_admin:
      type: boolean

PaginatedPrincipals:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/Principal'
    next_page_token:
      type: string

Group:
  type: object
  properties:
    id:
      type: integer
      format: int64
    name:
      type: string
    description:
      type: string
    created_at:
      type: string
      format: date-time

CreateGroupRequest:
  type: object
  required: [name]
  properties:
    name:
      type: string
    description:
      type: string

GroupMember:
  type: object
  properties:
    group_id:
      type: integer
      format: int64
    member_type:
      type: string
    member_id:
      type: integer
      format: int64

CreateGroupMemberRequest:
  type: object
  required: [member_type, member_id]
  properties:
    member_type:
      type: string
    member_id:
      type: integer
      format: int64

PaginatedGroups:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/Group'
    next_page_token:
      type: string

PaginatedGroupMembers:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/GroupMember'
    next_page_token:
      type: string

PrivilegeGrant:
  type: object
  properties:
    id:
      type: integer
      format: int64
    principal_id:
      type: integer
      format: int64
    principal_type:
      type: string
    securable_type:
      type: string
    securable_id:
      type: integer
      format: int64
    privilege:
      type: string
    granted_by:
      type: integer
      format: int64
      nullable: true
    granted_at:
      type: string
      format: date-time

CreateGrantRequest:
  type: object
  required: [principal_id, principal_type, securable_type, securable_id, privilege]
  properties:
    principal_id:
      type: integer
      format: int64
    principal_type:
      type: string
    securable_type:
      type: string
    securable_id:
      type: integer
      format: int64
    privilege:
      type: string

PaginatedGrants:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/PrivilegeGrant'
    next_page_token:
      type: string

APIKeyInfo:
  type: object
  properties:
    id:
      type: integer
      format: int64
    principal_id:
      type: integer
      format: int64
    name:
      type: string
    key_prefix:
      type: string
    expires_at:
      type: string
      format: date-time
      nullable: true
    created_at:
      type: string
      format: date-time

CreateAPIKeyRequest:
  type: object
  required: [principal_id, name]
  properties:
    principal_id:
      type: integer
      format: int64
    name:
      type: string
    expires_at:
      type: string
      format: date-time

CreateAPIKeyResponse:
  type: object
  properties:
    id:
      type: integer
      format: int64
    key:
      type: string
      description: Raw API key (shown only once)
    name:
      type: string
    key_prefix:
      type: string
    expires_at:
      type: string
      format: date-time
      nullable: true
    created_at:
      type: string
      format: date-time

PaginatedAPIKeys:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/APIKeyInfo'
    next_page_token:
      type: string

CleanupAPIKeysResponse:
  type: object
  properties:
    deleted_count:
      type: integer
      format: int64

RowFilter:
  type: object
  properties:
    id:
      type: integer
      format: int64
    table_id:
      type: integer
      format: int64
    filter_sql:
      type: string
    description:
      type: string
    created_at:
      type: string
      format: date-time

CreateRowFilterRequest:
  type: object
  required: [filter_sql]
  properties:
    table_id:
      type: integer
      format: int64
      description: Table ID (required when creating via top-level POST /row-filters)
    filter_sql:
      type: string
    description:
      type: string

RowFilterBindingRequest:
  type: object
  required: [principal_id, principal_type]
  properties:
    principal_id:
      type: integer
      format: int64
    principal_type:
      type: string

PaginatedRowFilters:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/RowFilter'
    next_page_token:
      type: string

ColumnMask:
  type: object
  properties:
    id:
      type: integer
      format: int64
    table_id:
      type: integer
      format: int64
    column_name:
      type: string
    mask_expression:
      type: string
    description:
      type: string
    created_at:
      type: string
      format: date-time

CreateColumnMaskRequest:
  type: object
  required: [column_name, mask_expression]
  properties:
    column_name:
      type: string
    mask_expression:
      type: string
    description:
      type: string

ColumnMaskBindingRequest:
  type: object
  required: [principal_id, principal_type]
  properties:
    principal_id:
      type: integer
      format: int64
    principal_type:
      type: string
    see_original:
      type: boolean
      default: false

PaginatedColumnMasks:
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/ColumnMask'
    next_page_token:
      type: string
