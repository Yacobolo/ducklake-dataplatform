Principal:
  description: A security principal representing a user or service account.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    is_admin:
      type: boolean
      example: false
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreatePrincipalRequest:
  description: Request body for creating a new principal.
  type: object
  additionalProperties: false
  required: [name]
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    type:
      type: string
      default: user
      maxLength: 64
      enum: [user, group]
      example: user
    is_admin:
      type: boolean
      default: false
      example: false

UpdatePrincipalAdminRequest:
  description: Request body for updating a principal's admin status.
  type: object
  additionalProperties: false
  required: [is_admin]
  properties:
    is_admin:
      type: boolean
      example: false

PaginatedPrincipals:
  description: Paginated list of principals.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/Principal'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

Group:
  description: A group that can contain multiple principals for collective access control.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateGroupRequest:
  description: Request body for creating a new group.
  type: object
  additionalProperties: false
  required: [name]
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description

GroupMember:
  description: Represents a principal's membership in a group.
  type: object
  properties:
    group_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    member_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    member_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"

CreateGroupMemberRequest:
  description: Request body for adding a member to a group.
  type: object
  additionalProperties: false
  required: [member_type, member_id]
  properties:
    member_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    member_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"

PaginatedGroups:
  description: Paginated list of groups.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/Group'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

PaginatedGroupMembers:
  description: Paginated list of group members.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/GroupMember'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

PrivilegeGrant:
  description: A privilege grant linking a principal to a securable resource with a specific permission.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    securable_type:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      example: table
    securable_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    privilege:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      example: SELECT
    granted_by:
      type: string
      nullable: true
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    granted_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateGrantRequest:
  description: Request body for creating a new privilege grant.
  type: object
  additionalProperties: false
  required: [principal_id, principal_type, securable_type, securable_id, privilege]
  properties:
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    securable_type:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      example: table
    securable_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    privilege:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      example: SELECT

PaginatedGrants:
  description: Paginated list of privilege grants.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/PrivilegeGrant'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

APIKeyInfo:
  description: Metadata about an API key, excluding the secret key value.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    key_prefix:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: example-value
    expires_at:
      type: string
      format: date-time
      maxLength: 64
      nullable: true
      example: '2025-01-15T10:30:00Z'
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateAPIKeyRequest:
  description: Request body for creating a new API key.
  type: object
  additionalProperties: false
  required: [principal_id, name]
  properties:
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    expires_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateAPIKeyResponse:
  description: Response returned after creating an API key, including the raw secret shown only once.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    key:
      type: string
      description: Raw API key (shown only once)
      maxLength: 512
      pattern: '^\S+$'
      example: dkl_key_example0000000000000000
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: my-resource
    key_prefix:
      type: string
      maxLength: 255
      pattern: '^\S+$'
      example: example-value
    expires_at:
      type: string
      format: date-time
      maxLength: 64
      nullable: true
      example: '2025-01-15T10:30:00Z'
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

PaginatedAPIKeys:
  description: Paginated list of API key metadata.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/APIKeyInfo'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

CleanupAPIKeysResponse:
  description: Response returned after cleaning up expired API keys.
  type: object
  properties:
    deleted_count:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807
      example: 3

RowFilter:
  description: A row-level security filter applied to a table.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    table_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    filter_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      example: example-value
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateRowFilterRequest:
  description: Request body for creating a new row-level security filter.
  type: object
  additionalProperties: false
  required: [filter_sql]
  properties:
    table_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      description: Table ID (required when creating via top-level POST /row-filters)
      example: "550e8400-e29b-41d4-a716-446655440000"
    filter_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      example: example-value
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description

RowFilterBindingRequest:
  description: Request body for binding a row filter to a principal.
  type: object
  additionalProperties: false
  required: [principal_id, principal_type]
  properties:
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user

PaginatedRowFilters:
  description: Paginated list of row-level security filters.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/RowFilter'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9

ColumnMask:
  description: A column masking rule that transforms column values for specific principals.
  type: object
  properties:
    id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    table_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    column_name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: email
    mask_expression:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      example: '***'
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description
    created_at:
      type: string
      format: date-time
      maxLength: 64
      example: '2025-01-15T10:30:00Z'

CreateColumnMaskRequest:
  description: Request body for creating a new column mask.
  type: object
  additionalProperties: false
  required: [column_name, mask_expression]
  properties:
    column_name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      example: email
    mask_expression:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      example: '***'
    description:
      type: string
      maxLength: 1024
      pattern: '[\s\S]+'
      example: A detailed description

ColumnMaskBindingRequest:
  description: Request body for binding a column mask to a principal.
  type: object
  additionalProperties: false
  required: [principal_id, principal_type]
  properties:
    principal_id:
      type: string
      pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
      maxLength: 36
      example: "550e8400-e29b-41d4-a716-446655440000"
    principal_type:
      type: string
      maxLength: 64
      enum: [user, group]
      example: user
    see_original:
      type: boolean
      default: false
      example: true

PaginatedColumnMasks:
  description: Paginated list of column masks.
  type: object
  properties:
    data:
      type: array
      items:
        $ref: '#/ColumnMask'
      maxItems: 1000
      example: []
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
      example: eyJpZCI6MTB9
