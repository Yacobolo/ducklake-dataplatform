AuditEntry:
  description: A record of an auditable action performed by a principal.
  type: object
  properties:
    id:
      type: integer
      format: int64
      minimum: 1
      maximum: 9223372036854775807
    principal_name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    action:
      type: string
      maxLength: 64
      pattern: '^\S+$'
    statement_type:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      nullable: true
    original_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      nullable: true
    rewritten_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      nullable: true
    tables_accessed:
      type: array
      maxItems: 1000
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
    status:
      type: string
      maxLength: 64
      pattern: '^\S+$'
    error_message:
      type: string
      maxLength: 4096
      pattern: '[\s\S]+'
      nullable: true
    duration_ms:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807
      nullable: true
    created_at:
      type: string
      format: date-time
      maxLength: 64

PaginatedAuditLogs:
  description: A paginated list of audit log entries.
  type: object
  properties:
    data:
      type: array
      maxItems: 1000
      items:
        $ref: '#/AuditEntry'
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'

ManifestRequest:
  description: Request to retrieve the manifest for a specific table.
  type: object
  required: [table]
  properties:
    table:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    schema:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
      default: main

ManifestColumn:
  description: A column definition within a table manifest.
  type: object
  properties:
    name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    type:
      type: string
      maxLength: 64
      pattern: '^\S+$'

ManifestResponse:
  description: The manifest of a table including its schema, files, and access controls.
  type: object
  properties:
    table:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    schema:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    columns:
      type: array
      maxItems: 10000
      items:
        $ref: '#/ManifestColumn'
    files:
      type: array
      maxItems: 100000
      items:
        type: string
        maxLength: 2048
        pattern: '^\S+$'
    row_filters:
      type: array
      maxItems: 100
      items:
        type: string
        maxLength: 65536
        pattern: '[\s\S]+'
    column_masks:
      type: object
      additionalProperties:
        type: string
        maxLength: 255
        pattern: '[\s\S]+'
    expires_at:
      type: string
      format: date-time
      maxLength: 64

QueryHistoryEntry:
  description: A historical record of a query executed by a principal.
  type: object
  properties:
    id:
      type: integer
      format: int64
      minimum: 1
      maximum: 9223372036854775807
    principal_name:
      type: string
      maxLength: 255
      pattern: '^\S.*$'
    original_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      nullable: true
    rewritten_sql:
      type: string
      maxLength: 65536
      pattern: '[\s\S]+'
      nullable: true
    statement_type:
      type: string
      maxLength: 64
      pattern: '^\S+$'
      nullable: true
    tables_accessed:
      type: array
      maxItems: 1000
      items:
        type: string
        maxLength: 255
        pattern: '^\S+$'
    status:
      type: string
      maxLength: 64
      pattern: '^\S+$'
    error_message:
      type: string
      maxLength: 4096
      pattern: '[\s\S]+'
      nullable: true
    duration_ms:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807
      nullable: true
    rows_returned:
      type: integer
      format: int64
      minimum: 0
      maximum: 9223372036854775807
      nullable: true
    created_at:
      type: string
      format: date-time
      maxLength: 64

PaginatedQueryHistoryEntries:
  description: A paginated list of query history entries.
  type: object
  properties:
    data:
      type: array
      maxItems: 1000
      items:
        $ref: '#/QueryHistoryEntry'
    next_page_token:
      type: string
      maxLength: 4096
      pattern: '^\S+$'
