(()=>{(()=>{let c=document.querySelector("[data-reorder-url]"),i=c instanceof HTMLElement&&c.dataset.reorderUrl||"",s=()=>Array.from(document.querySelectorAll("[data-notebook-cell='true']")),f=()=>{let e=document.querySelector("input[name='csrf_token']");return e instanceof HTMLInputElement?e.value:""},d=()=>{let e=document.activeElement;return e?e.closest("[data-notebook-cell='true']"):null},m=e=>{if(!e)return;let t=e.querySelector("[data-cell-editor='true']");if(t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement){t.focus();let r=t.value.length;typeof t.setSelectionRange=="function"&&t.setSelectionRange(r,r)}},u=e=>{let t=s(),r=d();if(!r||t.length===0)return;let a=t.indexOf(r);if(a===-1)return;let n=t[a+e];n&&m(n)};if(document.addEventListener("keydown",e=>{let t=e.target;if(!(t instanceof HTMLElement))return;let r=t.matches("textarea, input, select"),a=d();if(e.key==="Enter"&&e.shiftKey&&a){let n=a.querySelector("[data-run-cell='true']");n instanceof HTMLButtonElement&&(e.preventDefault(),n.click());return}if(!(!r||!a)){if(e.key==="j"&&!e.metaKey&&!e.ctrlKey&&!e.altKey){e.preventDefault(),u(1);return}if(e.key==="k"&&!e.metaKey&&!e.ctrlKey&&!e.altKey){e.preventDefault(),u(-1);return}if(e.key==="a"&&!e.metaKey&&!e.ctrlKey&&!e.altKey){let n=a.querySelector("[data-add-above='true']");n instanceof HTMLButtonElement&&(e.preventDefault(),n.click());return}if(e.key==="b"&&!e.metaKey&&!e.ctrlKey&&!e.altKey){let n=a.querySelector("[data-add-below='true']");n instanceof HTMLButtonElement&&(e.preventDefault(),n.click())}}}),!i)return;let o=null,g=async()=>{let e=s(),t=new URLSearchParams;e.forEach(n=>{let l=n.getAttribute("data-cell-id");l&&t.append("cell_ids",l)});let r=f();r&&t.set("csrf_token",r),(await fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:t.toString()})).ok||window.location.reload()};s().forEach(e=>{e.draggable=!0,e.addEventListener("dragstart",t=>{let r=t.target;if(!(r instanceof HTMLElement)||!r.closest("[data-drag-handle='true']")){t.preventDefault();return}o=e,e.classList.add("dragging"),t.dataTransfer&&(t.dataTransfer.effectAllowed="move")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),s().forEach(t=>t.classList.remove("drag-over")),o=null}),e.addEventListener("dragover",t=>{!o||o===e||(t.preventDefault(),e.classList.add("drag-over"))}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",async t=>{if(!o||o===e)return;t.preventDefault(),e.classList.remove("drag-over");let r=e.parentElement;if(!r)return;let a=e.getBoundingClientRect();t.clientY>a.top+a.height/2?r.insertBefore(o,e.nextSibling):r.insertBefore(o,e),await g()})})})();})();
