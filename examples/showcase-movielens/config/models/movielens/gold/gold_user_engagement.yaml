apiVersion: duck/v1
kind: Model
metadata:
  name: gold_user_engagement
spec:
  materialization: VIEW
  description: Gold aggregate of user activity and quality preference
  tags: [gold, movielens]
  freshness:
    max_lag_seconds: 3600
    cron_schedule: "*/30 * * * *"
  sql: |
    SELECT
      user_id,
      region,
      COUNT(*) AS ratings_submitted,
      ROUND(AVG(rating), 3) AS avg_rating_given,
      SUM(CASE WHEN rating_bucket = 'excellent' THEN 1 ELSE 0 END) AS excellent_votes
    FROM lake.silver_ratings_enriched
    GROUP BY user_id, region
