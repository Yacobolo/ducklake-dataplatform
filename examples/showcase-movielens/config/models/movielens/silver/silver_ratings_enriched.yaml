apiVersion: duck/v1
kind: Model
metadata:
  name: silver_ratings_enriched
spec:
  materialization: TABLE
  description: Ratings enriched with user and movie attributes
  tags: [silver, movielens]
  sql: |
    SELECT
      r.user_id,
      r.movie_id,
      r.rating,
      r.rating_ts,
      u.region,
      u.age_group,
      m.genres,
      {{ rating_bucket(r.rating) }} AS rating_bucket
    FROM lake.bronze_ratings r
    JOIN lake.silver_users u ON u.user_id = r.user_id
    JOIN lake.silver_movies m ON m.movie_id = r.movie_id
